{% extends 'gasmapApp/base.html' %}

{% block title %}Ricerca Stazioni{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center mb-4">üîç Ricerca Stazioni</h1>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <form method="post" action="{% url 'gasmapApp:search_station' %}">
                {% csrf_token %}
                <div class="form-group mb-3">
                    <label for="address">Indirizzo:</label>
                    <select id="address" name="address" class="form-select">
                        {% for addr in addresses %}
                        <option value="{{ addr.id }}">{{ addr.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label for="fuel_type" class="form-label">Tipo di Carburante</label>
                    <select id="fuel_type" name="fuel_type" class="form-select">
                        {% for fuel in fuel_types %}
                        <option value="{{ fuel.id }}">{{ fuel.description }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label for="order_by" class="form-label">Ordinamento</label>
                    <select id="order_by" name="order_by" class="form-select">
                        <option value="asc">Crescente</option>
                        <option value="desc">Decrescente
                        </option>
                    </select>
                </div>

                <input type="hidden" id="lat" name="lat" value="">
                <input type="hidden" id="lng" name="lng" value="">

                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Cerca</button>
                </div>
            </form>


            {% if results %}
            <div class="mt-3">
                <h4>Risultati della ricerca: {{ count }}</h4>
                <h6>Entro 5 km di distanza dall'indirizzo inserito</h6>
                <ul class="list-group">
                    {% for result in results %}
                    <li class="list-group-item">
                        <div>
                            <strong>{{ result.name }}</strong><br>
                            <small>Indirizzo: {{ result.address }}</small><br>
                            <small>Brand: {{ result.brand }}</small><br>
                            <small>Inserito il: {{ result.insertDate|date:"d F Y, H:i" }}</small><br>
                        </div>

                        <div class="table-responsive mt-3">
                            <table class="table table-striped table-bordered">
                                <thead class="thead-dark">
                                <tr>
                                    <th>Nome Carburante</th>
                                    <th>Self-Service</th>
                                    <th>Servito</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for fuel_name, services in result.fuels %}
                                <tr>
                                    <td>{{ fuel_name }}</td>

                                    <!-- Colonna per carburanti self-service -->
                                    <td class="text-center">
                                        {% if services.self_service %}
                                        {% for service in services.self_service %}
                                        {{ service.price }} ‚Ç¨/litro<br>
                                        {% endfor %}
                                        {% else %}
                                        - <!-- Nessun carburante self-service trovato -->
                                        {% endif %}
                                    </td>

                                    <!-- Colonna per carburanti servito -->
                                    <td class="text-center">
                                        {% if services.served %}
                                        {% for service in services.served %}
                                        {{ service.price }} ‚Ç¨/litro<br>
                                        {% endfor %}
                                        {% else %}
                                        - <!-- Nessun carburante servito trovato -->
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <form method="post" action="{% url 'gasmapApp:add_station' %}">
                            {% csrf_token %}
                            <input type="hidden" name="name" value="{{ result.id }}">
                            <button type="submit" class="btn btn-success btn-sm">Salva</button>
                        </form>
                    </li>
                    {% empty %}
                    <li class="list-group-item">Nessun risultato trovato.</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}


        </div>
    </div>
</div>
{% endblock %}

